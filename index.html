<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Simple Writer</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="css/materialize.min.css">
        <link href="css/icon.css" rel="stylesheet">
        <script src="node_modules/jquery/dist/jquery.js"></script>
        <script>var hammer = require('hammerjs');</script>
        <script src="js/materialize.min.js"></script>
        <style>
            /*
            @font-face {
                font-family: myFirstFont;
                src: url('fonts/Proxima Nova.otf');
            }
            */

            @font-face {
                font-family: 'Material Icons';
                font-style: normal;
                font-weight: 400;
                src: url(icons/iconfont/MaterialIcons-Regular.eot); /* For IE6-8 */
                src: local('Material Icons'),
                        local('MaterialIcons-Regular'),
                        url(icons/iconfont/MaterialIcons-Regular.woff2) format('woff2'),
                        url(icons/iconfont/MaterialIcons-Regular.woff) format('woff'),
                        url(icons/iconfont/MaterialIcons-Regular.ttf) format('truetype');
            }

            .material-icons {
            font-family: 'Material Icons';
            font-weight: normal;
            font-style: normal;
            font-size: 24px;  /* Preferred icon size */
            display: inline-block;
            line-height: 1;
            text-transform: none;
            letter-spacing: normal;
            word-wrap: normal;
            white-space: nowrap;
            direction: ltr;

            /* Support for all WebKit browsers. */
            -webkit-font-smoothing: antialiased;
            /* Support for Safari and Chrome. */
            text-rendering: optimizeLegibility;

            /* Support for Firefox. */
            -moz-osx-font-smoothing: grayscale;

            /* Support for IE. */
            font-feature-settings: 'liga';
            }

            body {
                max-height: 100vh !important;
                -webkit-app-region: drag
            }

            .materialize-textarea {
                height: 75vh !important; 
            }

            textarea {
                text-align: justify;
                size: 16em;
            }

            

            
        </style>
    </head>
    <body>
        <!--
        We are using node <script>document.write(process.versions.node)</script>,
        Chrome <script>document.write(process.versions.chrome)</script>,
        and Electron <script>document.write(process.versions.electron)</script>.
        -->
        <header>
            <ul id="slide-out" class="side-nav">
                <li><a href="#!" id="open">Open</a></li>
                <li><a href="#!" id="save">Save</a></li>
                <li><div class="divider"></div></li>
                <li class="no-padding">
                    <ul class="collapsible collapsible-accordion">
                        <li>
                            <a class="collapsible-header">Stats<i class="material-icons right">arrow_drop_down</i></a>
                            <div class="collapsible-body">
                                <ul>
                                    <li><a href="#!">Words: <span id="word"></span></a></li>
                                    <li><a href="#!">Chars: <span id="char"></span></a></li>
                                    <!--<li><a href="#!">Paragraphs:</a></li>-->
                                </ul>
                            </div>
                        </li>
                    </ul>
                </li>
            </ul>
            <a href="#" data-activates="slide-out" class="button-collapse">
                <i class="material-icons">menu</i>
            </a>
        </header>
        <main>
            <div class="container">
                <div class="row"></div>
                <div class="row">
                    <form class="col s12 m8 offset-m2" id="simplewriter">
                        <div class="row">
                            <div class="input-field col s12">
                                <textarea id="content" class="materialize-textarea z-depth-3">

                                </textarea>
                            </div>
                        </div>
                    </form>

                </div>
            </div>
        </main>
        
        <script>
            const { ipcRenderer } = require('electron');
            const fs = require('fs');
            
            
            let content = $('#content');
                openButton = $('#open'),
                saveButton = $('#save');

            $(openButton).on("click", function (e) {
                e.preventDefault();
                ipcRenderer.send('openFile');
            });

            $(saveButton).on("click", function (e) {
                e.preventDefault();
                ipcRenderer.send('saveFile', content)
            });
            

            ipcRenderer.on('fileData', (event, data) => {
                let elem = document.getElementById('content');
                elem.innerHTML = data.toString();
            });

            ipcRenderer.on('saveConfirmation', (event, path) => {
                let content = $('#content').val();
                        
                fs.writeFile(path, content, (err) => {
                    if (err) 
                        alert("An error ocurred creating the file " + err.message)
                });
            })
        </script>
        <script>
            $(document).ready(function () {
                $('#content').val('');
                $('#content').focus();
                $('.button-collapse').sideNav({
                    menuWidth: 150, // Default is 300
                    edge: 'left', // Choose the horizontal origin
                    closeOnClick: true, // Closes side-nav on <a> clicks, useful for Angular/Meteor
                    draggable: false // Choose whether you can drag to open on touch screens
                    }
                );
            });
        </script>
        <script src="./write.js"></script>
    </body>
</html>